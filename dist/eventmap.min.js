/*! eventmap - v1.4.1 - 27-01-2015 */
(function(){"use strict";var a,b,c=[].slice;b=this,a=function(){var a,d,e,f,g;return null==Object.getPrototypeOf&&(Object.getPrototypeOf=function(a){var b;return b=a.__proto__,b||null===b?b:a.constructor?a.constructor:Object.prototype}),function(){return null!=Array.isArray?Array.isArray:Array.isArray=function(a){return a.push===Array.prototype.push&&null!=a.length}}(),g={}.hasOwnProperty,f=function(a,b){var c,d;null==a&&(a={});for(c in b)d=b[c],g.call(a,c)||("object"==typeof d&&null!==d?(a[c]={},f(a[c],d)):a[c]=d);return a},e=function(a){if("*"===a)throw new Error("* is not allowed as an event name")},d=function(a,b,c){var d,f;return e(b),(d=this.events.listeners)[b]||(d[b]={}),((f=this.events.listeners[b])[a]||(f[a]=[])).push(c)},a=function(){function a(a){a=f(a,{sender:null,shorthandFunctions:{enabled:!0,separator:"/"}}),this.events={listeners:{},sender:a.sender,valid:[],options:{shorthandFunctions:{enabled:a.shorthandFunctions.enabled,separator:a.shorthandFunctions.separator}}}}return a.alternateNames=!0,a.maxListeners=-1,a.prototype.serialize=function(){var a,b;try{b=JSON.stringify(this.events.listeners,function(a,b){return"function"==typeof b&&(b=b.toString()),b})}catch(c){a=c,console.error("Error while serializing eventmap: "+a)}return b},a.prototype.deserialize=function(a){var b,c;try{c=JSON.parse(a,function(a,b){return 0===b.indexOf("function")&&(b=new Function(b)()),b})}catch(d){return b=d,console.error("Error while deserializing eventmap: "+b),!1}return this.events.listeners=c,!0},a.prototype.bind=function(a,b){var d,e,f,g;if(null==b&&(b=this),this.events.options.shorthandFunctions.enabled){for(Array.isArray(a)||(a=[a]),d=function(a){return b[a]?void 0:b[a]=function(){var b;return b=1<=arguments.length?c.call(arguments,0):[],b.unshift(a),this.trigger.apply(this,b)}},f=0,g=a.length;g>f;f++)e=a[f],d(e);return this}},a.prototype.on=function(b,c){var d,f,g,h,i;if(c&&!(this.events.valid.length>0&&-1===this.events.valid.indexOf(b))){if((g=this.events.listeners)[b]||(g[b]={id:-1,type:""}),f=a.maxListeners,f>0&&(d="Event "+b+" already has "+f+" events",f===((h=this.events.listeners[b]).now||(h.now=[])).length))throw new Error(d);return e(b),((i=this.events.listeners[b]).now||(i.now=[])).push(c),this.bind(b),this}},a.prototype.off=function(a){var c,d,e;if(a&&this.events.listeners[a])return e=this.events.listeners[a],c=e.id,d=e.type,("once"===d||"repeat"===d)&&("repeat"===d&&b.clearInterval(c),"once"===d&&b.clearTimeout(c)),this.events.listeners[a]&&delete this.events.listeners[a],this},a.prototype.one=function(a,b){return this.on(a,function(c){return function(){return b.apply(c,arguments),c.off(a)}}(this))},a.prototype.before=function(a,b){return b?(d.call(this,"before",a,b),this):void 0},a.prototype.after=function(a,b){return b?(d.call(this,"after",a,b),this):void 0},a.prototype.clear=function(){return this.events.listeners={},this.events.valid=[],this},a.prototype.all=function(){return this.trigger("*"),this},a.prototype.trigger=function(){var a,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(h=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],null!=h)if("*"!==h){if(Array.isArray(h))for(q=0,s=h.length;s>q;q++)f=h[q],this.trigger(f,a);if("object"==typeof h?(j=h.name,i=h.interval,k=h.repeat,d=h.context,e=h.delay,l=h.sender):j=h,null!=(null!=(u=this.events.listeners[j])?u.now:void 0))return null==i&&(i=0),null==k&&(k=!1),null==d&&(d={}),null==e&&(e=0),null==l&&(l=this.events.sender),null==l&&(d.sender=l),o=function(b){return function(){var c,e,g,h;return h=b.events.listeners[j].now||[],e=b.events.listeners[j].before||[],c=b.events.listeners[j].after||[],g=function(c){var e,g,h,i,j;if(null!=c)for(g=0,i=c.length;i>g;g++)if(e=c[g],"string"==typeof e)b.trigger(e,a);else if(Array.isArray(e))for(h=0,j=e.length;j>h;h++)f=e[h],b.trigger(f,a);else e.apply(d,a);return null},g(e),g(h),g(c)}}(this),g=this.events.listeners[j],n=function(){return i?k?(g.type="repeat",g.id=b.setInterval(function(){return o.call(this)},i)):(g.type="once",g.id=b.setTimeout(function(){return o.call(this)},i)):(g.type="direct",o.call(this)),null},e?m=b.setTimeout(function(){return n.call(this),b.clearTimeout(m)},e):n.call(this),this}else for(t=Object.keys(this.events.listeners),p=0,r=t.length;r>p;p++)f=t[p],this.trigger(f,a)},a.mixin=function(b,c){var d;return d=new a,b.events=d.events,Object.keys(Object.getPrototypeOf(d)).forEach(function(d){return c?c.prototype[d]=a.prototype[d]:b[d]=a.prototype[d].bind(b)}),this},a.alternateNames&&(a.prototype.addListener=a.prototype.on,a.prototype.removeListener=a.prototype.off,a.prototype.emit=a.prototype.trigger,a.prototype.once=a.prototype.one),a}(),a.maxListeners=-1,a},"function"==typeof define&&define.amd?define("eventmap",[],a):null!==typeof exports?module.exports=a():window.EventMap=a()}).call(this);