/*! eventmap - v2.1.0 - 08-11-2015 */
(function(){"use strict";var a,b,c=[].slice;b=this,a=function(){var a,d,e,f,g,h;return h=Array.prototype.slice,g={}.hasOwnProperty,f=function(a,b){var c,d;null==a&&(a={});for(c in b)d=b[c],g.call(a,c)||("object"==typeof d&&null!==d?(a[c]={},f(a[c],d)):a[c]=d);return a},e=function(a){if("*"===a)throw new Error("* is not allowed as an event name")},d=function(a,b,c){var d,f;return e(b),(d=this.events.listeners)[b]||(d[b]={}),((f=this.events.listeners[b])[a]||(f[a]=[])).push(c)},a=function(){function a(a){a=f(a,{sender:null,shorthandFunctions:{enabled:!0,separator:"/"}}),this.events={listeners:{},sender:a.sender,valid:[],options:{shorthandFunctions:{enabled:a.shorthandFunctions.enabled,separator:a.shorthandFunctions.separator}}}}return a.alternateNames=!0,a.maxListeners=-1,a.prototype.serialize=function(){var a,b;try{b=JSON.stringify(this.events.listeners,function(a,b){return"function"==typeof b&&(b=b.toString()),b})}catch(c){a=c,console.error("Error while serializing eventmap: "+a)}return b},a.prototype.deserialize=function(a){var b,c;try{c=JSON.parse(a,function(a,b){return 0===b.indexOf("function")&&(b=new Function(b)()),b})}catch(d){return b=d,console.error("Error while deserializing eventmap: "+b),!1}return this.events.listeners=c,!0},a.prototype.bind=function(a,b){var d,e,f,g;if(null==b&&(b=this),this.events.options.shorthandFunctions.enabled){for(Array.isArray(a)||(a=[a]),d=function(a){return b[a]?void 0:b[a]=function(){var b;return b=1<=arguments.length?c.call(arguments,0):[],b.unshift(a),this.trigger.apply(this,b)}},f=0,g=a.length;g>f;f++)e=a[f],d(e);return this}},a.prototype.on=function(b,c){var d,f,g,h,i;if(c&&!(this.events.valid.length>0&&-1===this.events.valid.indexOf(b))){if((d=this.events.listeners)[b]||(d[b]={id:-1,type:""}),i=a.maxListeners,i>0&&(h="Event "+b+" already has "+i+" events",i===((f=this.events.listeners[b]).now||(f.now=[])).length))throw new Error(h);return e(b),((g=this.events.listeners[b]).now||(g.now=[])).push(c),this.bind(b),this}},a.prototype.off=function(a){var c,d,e;if(a&&this.events.listeners[a])return d=this.events.listeners[a],c=d.id,e=d.type,("once"===e||"repeat"===e)&&("repeat"===e&&b.clearInterval(c),"once"===e&&b.clearTimeout(c)),this.events.listeners[a]&&delete this.events.listeners[a],this},a.prototype.one=function(a,b){return this.on(a,function(c){return function(){return b.apply(c,arguments),c.off(a)}}(this))},a.prototype.before=function(a,b){return b?(d.call(this,"before",a,b),this):void 0},a.prototype.after=function(a,b){return b?(d.call(this,"after",a,b),this):void 0},a.prototype.clear=function(){return this.events.listeners={},this.events.valid=[],this},a.prototype.all=function(){return this.trigger("*"),this},a.prototype.trigger=function(){var a,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(h=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],null!=h)if("*"!==h){if(Array.isArray(h))for(k=0,m=h.length;m>k;k++)f=h[k],this.trigger(f,a);if("object"==typeof h?(n=h.name,j=h.interval,q=h.repeat,d=h.context,e=h.delay,r=h.sender):n=h,null!=(null!=(p=this.events.listeners[n])?p.now:void 0))return null==j&&(j=0),null==q&&(q=!1),null==d&&(d={}),null==e&&(e=0),null==r&&(r=this.events.sender),null==r&&(d.sender=r),u=function(b){return function(){var c,e,g,h;return h=b.events.listeners[n].now||[],e=b.events.listeners[n].before||[],c=b.events.listeners[n].after||[],g=function(c){var e,g,h,i,j;if(null!=c)for(g=0,i=c.length;i>g;g++)if(e=c[g],"string"==typeof e)b.trigger(e,a);else if(Array.isArray(e))for(h=0,j=e.length;j>h;h++)f=e[h],b.trigger(f,a);else e.apply(d,a);return null},g(e),g(h),g(c)}}(this),g=this.events.listeners[n],t=function(){return j?q?(g.type="repeat",g.id=b.setInterval(function(){return u.call(this)},j)):(g.type="once",g.id=b.setTimeout(function(){return u.call(this)},j)):(g.type="direct",u.call(this)),null},e?s=b.setTimeout(function(){return t.call(this),b.clearTimeout(s)},e):t.call(this),this}else for(o=Object.keys(this.events.listeners),i=0,l=o.length;l>i;i++)f=o[i],this.trigger(f,a)},a.mixin=function(b,c){var d;return d=new a,b.events=d.events,Object.keys(Object.getPrototypeOf(d)).forEach(function(d){return c?c.prototype[d]=a.prototype[d]:b[d]=a.prototype[d].bind(b)}),this},a.alternateNames&&(a.prototype.addListener=a.prototype.on,a.prototype.removeListener=a.prototype.off,a.prototype.emit=a.prototype.trigger,a.prototype.once=a.prototype.one),a}(),a.maxListeners=-1,a},"function"==typeof define&&define.amd?define([],a):"undefined"!=typeof exports&&null!==exports?module.exports=a():window.EventMap=a()}).call(this);