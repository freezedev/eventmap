/*! eventmap - v1.0.0 - 16-08-2013 */
!function(){"use strict";var a;a="undefined"!=typeof module&&null!==module&&module.exports,function(b){var c,d,e;return b.udefine||(b.udefine=function(c,d,e){var f,g,h,i,j;if(null==c)throw new Error("A udefine module needs to have a name");return"function"==typeof d&&(j=[c,[],d],c=j[0],d=j[1],e=j[2]),"undefined"!=typeof define&&null!==define?(define.amd||define.umd)&&(i=define.apply(this,arguments)):a?(h=function(){var a,c,e;for(e=[],a=0,c=d.length;c>a;a++)f=d[a],e.push(require(b.udefine.node[f]));return e}(),i=module.exports=e.apply(this)):(g=function(){var a,c,e;for(e=[],a=0,c=d.length;c>a;a++)f=d[a],e.push(b.udefine.globals[f]);return e}(),i=e.apply(this,g)),i}),(c=b.udefine).globals||(c.globals={}),(d=b.udefine).commonjs||(d.commonjs={}),(e=b.udefine).env||(e.env={amd:function(){return"undefined"!=typeof define&&null!==define&&(define.amd||define.umd)}(),commonjs:function(){return a}(),browser:function(){return!a}()}),null}(a?global:this)}.call(this),function(){!function(a){return a.udefine.globals.root=a,null!=a.define?define("root",function(){return a}):void 0}(this)}.call(this),function(){var a=[].slice;udefine("eventmap",["root"],function(b){"use strict";var c;return c=function(){function c(a){this.sender=a,this.events={},this.validEvents=[]}return c.prototype.serialize=function(){var a,b;try{b=JSON.stringify(this.events,function(a,b){return"function"==typeof b&&(b=b.toString()),b})}catch(c){a=c,console.error("Error while serializing eventmap: "+a)}return b},c.prototype.deserialize=function(a){var b,c;try{c=JSON.parse(a,function(a,b){return 0===b.indexOf("function")&&(b=new Function(b)()),b})}catch(d){return b=d,console.error("Error while deserializing eventmap: "+b),!1}return this.events=c,!0},c.prototype.on=function(a,b){var c;if(b&&!(this.validEvents.length>0&&-1===this.validEvents.indexOf(a)))return c={event:b,id:-1,type:"",sender:this.sender},this.events[a]?this.events[a].push(c):this.events[a]=[c],this},c.prototype.off=function(a){var c;if(a)return c=this.events[a].type,("once"===c||"repeat"===c)&&("repeat"===c&&b.clearInterval(this.events[a].id),"once"===c&&b.clearTimeout(this.events[a].id)),this.events[a]&&delete this.events[a],this},c.prototype.clear=function(){return this.events={},this.validEvents=[],this},c.prototype.trigger=function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(f=arguments[0],c=2<=arguments.length?a.call(arguments,1):[],null!=f&&("object"==typeof f?(i=f.name,h=f.interval,j=f.repeat,d=f.context,e=f.delay,n=f.useSender):i=f,this.events[i])){for(null==h&&(h=0),null==j&&(j=!1),null==d&&(d=this),null==e&&(e=0),m=function(a){return n?a.event.apply(d,[].concat.apply([],[[a.sender],c])):a.event.apply(d,c)},q=this.events[i],o=0,p=q.length;p>o;o++)g=q[o],l=function(){return h?j?(g.type="repeat",g.id=b.setInterval(m,h)):(g.type="once",g.id=b.setTimeout(m,h)):(g.type="direct",m.call(this,g)),null},e?k=b.setTimeout(function(){return l.call(this,g),b.clearTimeout(k)}):l.call(this,g);return this}},c}(),udefine.env.browser?b.EventMap=c:c})}.call(this);